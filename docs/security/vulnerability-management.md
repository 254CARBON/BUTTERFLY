# BUTTERFLY Vulnerability Management

> Security testing, CVE handling, and remediation processes

**Last Updated**: 2025-12-03  
**Target Audience**: Security engineers, developers

---

## Overview

This document outlines the vulnerability management process for BUTTERFLY, including detection, assessment, and remediation workflows.

---

## Vulnerability Detection

### Automated Scanning

| Scanner | Scope | Frequency |
|---------|-------|-----------|
| OWASP Dependency Check | Dependencies | Every build |
| Trivy | Container images | Every build |
| CodeQL | Source code (SAST) | Every PR |
| Semgrep | Source code (SAST) | Every PR |
| TruffleHog | Secrets | Every commit |
| Gitleaks | Secrets | Every commit |
| Checkov | Infrastructure | Every PR |

### CI/CD Integration

```yaml
# .github/workflows/security.yml
name: Security Scan

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  dependency-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: 'butterfly'
          path: '.'
          format: 'SARIF'
          args: >
            --failOnCVSS 7
            --suppression suppression.xml
      
      - name: Upload results
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: dependency-check-report.sarif

  container-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build image
        run: docker build -t butterfly/service:${{ github.sha }} .
      
      - name: Run Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'butterfly/service:${{ github.sha }}'
          format: 'sarif'
          output: 'trivy-results.sarif'
          severity: 'CRITICAL,HIGH'
          exit-code: '1'

  sast:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: java
      
      - name: Build
        run: ./gradlew build -x test
      
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2

  secrets-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: TruffleHog Scan
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD
          extra_args: --only-verified
```

### Manual Testing

| Test Type | Frequency | Scope |
|-----------|-----------|-------|
| Penetration Test | Annual | Full ecosystem |
| Red Team Exercise | Annual | Infrastructure + application |
| Code Review | Every PR | Security-sensitive changes |
| Architecture Review | Major releases | Design changes |

---

## Vulnerability Assessment

### Severity Classification

| Severity | CVSS Score | SLA |
|----------|------------|-----|
| Critical | 9.0 - 10.0 | 24 hours |
| High | 7.0 - 8.9 | 7 days |
| Medium | 4.0 - 6.9 | 30 days |
| Low | 0.1 - 3.9 | 90 days |
| Informational | N/A | Best effort |

### Risk Assessment Factors

- **Exploitability**: Is there a known exploit?
- **Attack Vector**: Network, adjacent, local, physical
- **Privileges Required**: None, low, high
- **User Interaction**: None required, required
- **Scope**: Changed, unchanged
- **Impact**: Confidentiality, integrity, availability
- **Business Context**: Data sensitivity, exposure

### Assessment Template

```markdown
## Vulnerability Assessment

**ID**: VULN-2024-001
**CVE**: CVE-2024-XXXXX
**Discovered**: 2024-12-03
**Component**: jackson-databind
**Version**: 2.15.0

### Description
[Description of the vulnerability]

### Impact
- Confidentiality: [None/Low/High]
- Integrity: [None/Low/High]
- Availability: [None/Low/High]

### CVSS Score
- Base: 7.5 (High)
- Temporal: 6.5
- Environmental: 6.0

### Exploitability
- Attack Vector: Network
- Privileges Required: None
- User Interaction: None
- Known Exploits: [Yes/No]

### Affected Systems
- [ ] CAPSULE
- [ ] ODYSSEY
- [x] PERCEPTION
- [ ] PLATO
- [ ] NEXUS

### Recommendation
Upgrade jackson-databind to version 2.15.3

### Status
[Open/In Progress/Resolved/Accepted Risk]
```

---

## Remediation Process

### Workflow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Vulnerability Remediation Flow                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Vulnerability Detected                                                      │
│       │                                                                      │
│       ▼                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 1. TRIAGE (within 24 hours)                                             ││
│  │    - Verify vulnerability                                               ││
│  │    - Assess severity                                                    ││
│  │    - Identify affected systems                                          ││
│  │    - Create tracking ticket                                             ││
│  └────────────────────────────────────┬────────────────────────────────────┘│
│                                       │                                      │
│                                       ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 2. ANALYZE                                                              ││
│  │    - Determine root cause                                               ││
│  │    - Evaluate remediation options                                       ││
│  │    - Assess risk of fix                                                 ││
│  └────────────────────────────────────┬────────────────────────────────────┘│
│                                       │                                      │
│                                       ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 3. REMEDIATE                                                            ││
│  │    - Implement fix                                                      ││
│  │    - Test fix                                                           ││
│  │    - Deploy to staging                                                  ││
│  │    - Deploy to production                                               ││
│  └────────────────────────────────────┬────────────────────────────────────┘│
│                                       │                                      │
│                                       ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 4. VERIFY                                                               ││
│  │    - Confirm fix effective                                              ││
│  │    - Re-scan for vulnerability                                          ││
│  │    - Update vulnerability record                                        ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Dependency Update Process

```bash
# Check for updates
./gradlew dependencyUpdates

# Update specific dependency
./gradlew updateDependency --dependency=jackson-databind --version=2.15.3

# Verify no breaking changes
./gradlew test integrationTest

# Check for new vulnerabilities
./gradlew dependencyCheckAnalyze
```

### Emergency Patching

For critical vulnerabilities:

1. **Immediate**: Create incident channel
2. **15 min**: Assess impact and exposure
3. **1 hour**: Develop and test patch
4. **2 hours**: Deploy to production
5. **4 hours**: Verify and communicate

---

## Suppression and Exceptions

### When to Suppress

- False positive confirmed
- Vulnerability not applicable (e.g., unused code path)
- Mitigating controls in place
- Accepted risk with approval

### Suppression Format

```xml
<!-- suppression.xml -->
<suppressions>
    <suppress>
        <notes>
            False positive: This vulnerability requires specific 
            configuration that we do not use. Reviewed 2024-12-03.
        </notes>
        <packageUrl regex="true">pkg:maven/com\.example/unused-lib@.*</packageUrl>
        <cve>CVE-2024-XXXXX</cve>
    </suppress>
    
    <suppress until="2025-01-01">
        <notes>
            Accepted risk: Upgrade blocked by API compatibility.
            Mitigated by WAF rule. Review by 2025-01-01.
        </notes>
        <gav regex="true">org\.example:.*</gav>
        <vulnerabilityName>CVE-2024-YYYYY</vulnerabilityName>
    </suppress>
</suppressions>
```

### Exception Approval

| Severity | Approver | Duration |
|----------|----------|----------|
| Critical | CISO | Max 7 days |
| High | Security Lead | Max 30 days |
| Medium | Engineering Lead | Max 90 days |
| Low | Team Lead | Max 180 days |

---

## Reporting

### Vulnerability Dashboard

- Total open vulnerabilities by severity
- Time to remediation trends
- Vulnerability by component
- Aging vulnerabilities

### Monthly Security Report

```markdown
# Security Report - [Month Year]

## Executive Summary
- Critical: X (↓/↑ from last month)
- High: X (↓/↑ from last month)
- Medium: X (↓/↑ from last month)
- Low: X (↓/↑ from last month)

## New Vulnerabilities
| ID | Severity | Component | Status |
|----|----------|-----------|--------|
| VULN-001 | High | jackson | Remediated |

## Resolved Vulnerabilities
| ID | Severity | Resolution |
|----|----------|------------|
| VULN-002 | Medium | Updated to 2.15.3 |

## Exceptions
| ID | Severity | Expiry | Reason |
|----|----------|--------|--------|
| VULN-003 | Low | 2025-01 | False positive |

## Recommendations
1. Update Spring Boot to latest LTS
2. Review aging medium vulnerabilities
```

---

## Responsible Disclosure

### Bug Bounty Program

- Platform: HackerOne
- URL: https://hackerone.com/butterfly
- Scope: Production systems
- Rewards: $500 - $10,000

### Reporting Vulnerabilities

If you discover a security vulnerability:

1. **Do NOT** disclose publicly
2. Email: security-reports@butterfly.example.com
3. Include:
   - Description
   - Steps to reproduce
   - Impact assessment
   - Your contact info

### Response Timeline

| Action | Timeline |
|--------|----------|
| Initial acknowledgment | 24 hours |
| Initial assessment | 72 hours |
| Status update | Weekly |
| Fix notification | Upon deployment |
| Public disclosure | 90 days or upon fix |

---

## Related Documentation

| Document | Description |
|----------|-------------|
| [Security Overview](README.md) | Security index |
| [Hardening Guide](hardening.md) | Security configuration |
| [Compliance](compliance.md) | Compliance requirements |

