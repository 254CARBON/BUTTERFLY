# =============================================================================
# AURORA Service Configuration
# =============================================================================

spring.application.name=aurora-service
server.port=8086

# =============================================================================
# Kafka Configuration
# =============================================================================
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.consumer.group-id=aurora-service
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=io.confluent.kafka.serializers.KafkaAvroDeserializer
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=io.confluent.kafka.serializers.KafkaAvroSerializer

# Schema Registry
aurora.kafka.schema-registry-url=${SCHEMA_REGISTRY_URL:http://localhost:8081}

# Kafka Topics
aurora.kafka.topics.anomalies-input=aurora.anomalies.detected
aurora.kafka.topics.anomalies-enriched=aurora.anomalies.enriched
aurora.kafka.topics.rca-hypotheses=aurora.rca.hypotheses
aurora.kafka.topics.remediation-actions=aurora.remediation.actions
aurora.kafka.topics.remediation-results=aurora.remediation.results
aurora.kafka.topics.chaos-learnings=aurora.chaos.learnings
aurora.kafka.topics.incidents-dlq=aurora.incidents.dlq

# Kafka Streams
aurora.kafka.streams.application-id=aurora-streams
aurora.kafka.streams.num-stream-threads=3
aurora.kafka.streams.processing-guarantee=exactly_once_v2
aurora.kafka.streams.commit-interval=1s
aurora.kafka.streams.replication-factor=1

# =============================================================================
# Redis Configuration (for caching, distributed locks)
# =============================================================================
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}

# =============================================================================
# Cassandra Configuration (for incident and immunity persistence)
# =============================================================================
spring.cassandra.contact-points=${CASSANDRA_HOSTS:localhost}
spring.cassandra.port=${CASSANDRA_PORT:9042}
spring.cassandra.keyspace-name=aurora
spring.cassandra.local-datacenter=datacenter1
spring.cassandra.schema-action=create-if-not-exists

# =============================================================================
# RCA Configuration
# =============================================================================
aurora.rca.correlation-window=5m
aurora.rca.min-confidence-threshold=0.6
aurora.rca.max-hypotheses=5
aurora.rca.grace-period=30s
aurora.rca.min-anomalies-for-rca=2
aurora.rca.topology-distance-weight=0.3
aurora.rca.timing-correlation-weight=0.4
aurora.rca.symptom-similarity-weight=0.3

# =============================================================================
# Safety Configuration
# =============================================================================
aurora.safety.max-concurrent-remediations=3
aurora.safety.default-blast-radius-limit=1000
aurora.safety.dry-run-default=true
aurora.safety.auto-approve-risk-threshold=0.3
aurora.safety.require-approval-above=0.5
aurora.safety.rollback-health-window=5m
aurora.safety.max-rollback-attempts=3
aurora.safety.remediation-cooldown=10m

# =============================================================================
# Remediation Configuration
# =============================================================================
aurora.remediation.default-timeout=5m
aurora.remediation.max-retry-attempts=3
aurora.remediation.initial-retry-backoff=5s
aurora.remediation.max-retry-backoff=2m
aurora.remediation.retry-backoff-multiplier=2.0
aurora.remediation.playbook-cache-ttl=5m
aurora.remediation.healing-tools-prefix=aurora-healing-

# =============================================================================
# PLATO Governance Client Configuration
# =============================================================================
aurora.plato.url=${PLATO_URL:http://localhost:8082}
aurora.plato.connect-timeout=5s
aurora.plato.read-timeout=30s
aurora.plato.quick-timeout=2s
aurora.plato.max-connections=50

# PLATO Circuit Breaker
aurora.plato.circuit-breaker.enabled=true
aurora.plato.circuit-breaker.failure-rate-threshold=50
aurora.plato.circuit-breaker.wait-duration-in-open-state=30s
aurora.plato.circuit-breaker.minimum-number-of-calls=10
aurora.plato.circuit-breaker.permitted-number-of-calls-in-half-open-state=5
aurora.plato.circuit-breaker.sliding-window-size=20

# PLATO Retry
aurora.plato.retry.max-attempts=2
aurora.plato.retry.initial-backoff=200ms
aurora.plato.retry.max-backoff=5s
aurora.plato.retry.jitter=0.35

# PLATO Fallback
aurora.plato.fallback.allow-on-unavailable=true
aurora.plato.fallback.use-cached-policies=true
aurora.plato.fallback.auto-approve-low-risk=true
aurora.plato.fallback.log-fallbacks=true

# PLATO Cache
aurora.plato.cache.enabled=true
aurora.plato.cache.policy-ttl=5m
aurora.plato.cache.approval-ttl=1m
aurora.plato.cache.max-policies=1000

# =============================================================================
# SYNAPSE Execution Client Configuration
# =============================================================================
aurora.synapse.url=${SYNAPSE_URL:http://localhost:8084}
aurora.synapse.connect-timeout=5s
aurora.synapse.read-timeout=30s
aurora.synapse.max-connections=50
aurora.synapse.circuit-breaker.enabled=true
aurora.synapse.circuit-breaker.failure-rate-threshold=50
aurora.synapse.circuit-breaker.wait-duration-in-open-state=30s
aurora.synapse.circuit-breaker.sliding-window-size=10

# =============================================================================
# CAPSULE Evidence Client Configuration
# =============================================================================
aurora.capsule.url=${CAPSULE_URL:http://localhost:8083}
aurora.capsule.connect-timeout=5s
aurora.capsule.read-timeout=30s
aurora.capsule.max-connections=30
aurora.capsule.local-buffer-size=1000

# =============================================================================
# Immunity Configuration
# =============================================================================
aurora.immunity.enabled=true
aurora.immunity.min-rule-confidence=0.7
aurora.immunity.rule-ttl=30d
aurora.immunity.max-rules-per-component=100
aurora.immunity.pattern-learning-window=7d

# =============================================================================
# Resilience4j Configuration
# =============================================================================
resilience4j.circuitbreaker.instances.plato-client.slidingWindowSize=20
resilience4j.circuitbreaker.instances.plato-client.failureRateThreshold=50
resilience4j.circuitbreaker.instances.plato-client.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.plato-client.permittedNumberOfCallsInHalfOpenState=5
resilience4j.circuitbreaker.instances.plato-client.minimumNumberOfCalls=10

resilience4j.circuitbreaker.instances.synapse-client.slidingWindowSize=10
resilience4j.circuitbreaker.instances.synapse-client.failureRateThreshold=50
resilience4j.circuitbreaker.instances.synapse-client.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.synapse-client.permittedNumberOfCallsInHalfOpenState=3

resilience4j.circuitbreaker.instances.capsule-client.slidingWindowSize=10
resilience4j.circuitbreaker.instances.capsule-client.failureRateThreshold=50
resilience4j.circuitbreaker.instances.capsule-client.waitDurationInOpenState=30s

resilience4j.retry.instances.plato-client.maxAttempts=2
resilience4j.retry.instances.plato-client.waitDuration=200ms
resilience4j.retry.instances.plato-client.retryExceptions=java.io.IOException,java.util.concurrent.TimeoutException

resilience4j.retry.instances.synapse-client.maxAttempts=3
resilience4j.retry.instances.synapse-client.waitDuration=500ms
resilience4j.retry.instances.synapse-client.retryExceptions=java.io.IOException,java.util.concurrent.TimeoutException

resilience4j.bulkhead.instances.remediation.maxConcurrentCalls=3
resilience4j.bulkhead.instances.remediation.maxWaitDuration=1s

# =============================================================================
# Actuator / Observability
# =============================================================================
management.endpoints.web.exposure.include=health,info,prometheus,metrics,env,circuitbreakers,retries
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=${ENVIRONMENT:development}
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles-histogram.aurora.rca.latency=true
management.metrics.distribution.percentiles-histogram.aurora.remediations.duration=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.75,0.95,0.99
management.metrics.distribution.percentiles.aurora.rca.latency=0.5,0.75,0.95,0.99
management.prometheus.metrics.export.enabled=true
management.tracing.sampling.probability=${TRACING_SAMPLE_RATE:1.0}
management.otlp.tracing.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://otel-collector:4318/v1/traces}

# =============================================================================
# Logging Configuration
# =============================================================================
logging.level.root=INFO
logging.level.com.z254.butterfly.aurora=DEBUG
logging.level.org.springframework.kafka=WARN
logging.level.org.apache.kafka=WARN
logging.level.org.apache.kafka.streams=INFO

# =============================================================================
# Security Configuration
# =============================================================================
aurora.security.api-key.enabled=true
aurora.security.api-key.header-name=X-API-Key
aurora.security.jwt.enabled=false
aurora.security.jwt.issuer-uri=${JWT_ISSUER_URI:}

# =============================================================================
# OpenAPI Configuration
# =============================================================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true

# =============================================================================
# BUTTERFLY Tenant Context Propagation
# =============================================================================
butterfly.tenant.enabled=${BUTTERFLY_TENANT_ENABLED:true}
butterfly.tenant.header-name=X-Tenant-ID
butterfly.tenant.query-param-name=tenantId
butterfly.tenant.jwt-claim-name=tenant_id
butterfly.tenant.default-tenant-id=${BUTTERFLY_DEFAULT_TENANT:default}
butterfly.tenant.require-tenant-context=${BUTTERFLY_REQUIRE_TENANT:false}
butterfly.tenant.kafka-header-name=x-tenant-id
butterfly.tenant.excluded-paths=/actuator/**,/health/**,/swagger/**,/v3/api-docs/**,/api-docs/**
